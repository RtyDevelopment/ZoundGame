<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>w = 10;
h = 10;
gridsize = 10;
surfsize = 50;
wallperc = 0.2;

maze = create_maze(w, h);
surf = -1;
col1 = -1;
col2 = -1;
gridperc = 1-wallperc*2;
x = gridsize/2;
y = gridsize/2;
direction = 0;
zdirection = 0;

view_xview[0] = 0;
view_yview[0] = 0;
view_object[0] = noone;
view_visible[0] = true;
view_enabled = true;

if (os_get_config()!="OEM") {
    d3d_start();
    d3d_set_hidden(true);
    d3d_set_lighting(false);
    d3d_set_culling(false);
    //d3d_set_fog(true,c_black,10,300);
    texture_set_interpolation(true);
} else {
    //viewstuff
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if (os_get_config()!="OEM") {
    var xx,yy,cx,cy;
    xx = window_mouse_get_x();
    yy = window_mouse_get_y();
    cx = round(window_get_width()/2);
    cy = round(window_get_height()/2);
    direction = (direction-(xx-cx)/10) mod 360;
    zdirection = max(-89,min(89,zdirection-(yy-cy)/10));
    window_mouse_set(cx,cy);
}

if (keyboard_check(vk_alt)==true &amp;&amp; keyboard_check(vk_f4)==true || keyboard_check(vk_escape)) game_end();

var xold, yold;
xold = x;
yold = y;

if (os_get_config()!="OEM") {
    if (keyboard_check(ord("W"))==true) {
        maze_move_self(maze, x, y, direction, 1/16*gridsize, 0, gridsize, 0.6, 0.15);
    }
    if (keyboard_check(ord("S"))==true) {
        maze_move_self(maze, x, y, direction+180, 1/16*gridsize, 0, gridsize, 0.6, 0.15);
    }
    if (keyboard_check(ord("A"))==true) {
        maze_move_self(maze, x, y, direction+90, 1/16*gridsize, 0, gridsize, 0.6, 0.15);
    }
    if (keyboard_check(ord("D"))==true) {
        maze_move_self(maze, x, y, direction+270, 1/16*gridsize, 0, gridsize, 0.6, 0.15);
    }
} else {
    if (keyboard_check_pressed(ord("W"))==true) {
        if (string_char_at(ds_grid_get(maze, floor(x/gridsize), floor(y/gridsize)), (((360-direction)/90+1) mod 4)+1) == "1") {
            maze_move_self(maze, x, y, direction, gridsize, 0, gridsize, 0.6, 0.15);
        }
    }
    if (keyboard_check_pressed(ord("A"))==true) direction += 90;
    if (keyboard_check_pressed(ord("D"))==true) direction -= 90;
}

globalvar xto, yto, zto, xup, yup, zup, xx, yy, zz;
var v_dist, v_dir;
v_dist = point_distance(xold, yold, x, y);
v_dir = point_direction(xold, yold, x, y);
audio_listener_position(x, y, 0.65*gridsize);
audio_listener_velocity(lengthdir_x(v_dist, v_dir), lengthdir_y(v_dist, v_dir), 0);
audio_listener_orientation(xx+xto,yy+yto,zz+zto,xup,yup,zup);

if (keyboard_check_pressed(vk_space)==true) {
    with (instance_create(x, y, obj_gameobject)) {
        type = 0;
        direction = other.direction;
        zdirection = other.zdirection;
    }
}

if (mouse_check_button_pressed(mb_left)==true) {
    with (instance_create(x, y, obj_gameobject)) {
        type = 1;
        direction = other.direction;
        zdirection = other.zdirection;
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="64">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>draw_set_alpha(1);
draw_set_color(c_green);
var cx = room_width-50;
var cy = 50;
draw_circle(cx, cy, 50, 1);
draw_triangle(cx+lengthdir_x(10, direction+90), cy+lengthdir_y(10, direction+90), cx+lengthdir_x(10, direction-90), cy+lengthdir_y(10, direction-90), cx+lengthdir_x(50, direction), cy+lengthdir_y(50, direction), 0);
draw_triangle(cx+lengthdir_x(10, direction+90), cy+lengthdir_y(10, direction+90), cx+lengthdir_x(10, direction-90), cy+lengthdir_y(10, direction-90), cx+lengthdir_x(30, direction+180), cy+lengthdir_y(30, direction+180), 0);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>draw_set_color(c_white);
draw_set_alpha(1);
d3d_end();
if (surface_exists(surf)==false) {
    surf = surface_create(w*surfsize, h*surfsize);
    surface_set_target(surf);
    draw_set_color(c_navy);
    draw_rectangle(0, 0, w*surfsize, h*surfsize, 0);
    maze_draw_map(maze,0,0,w*surfsize,h*surfsize,gridperc,c_white,3,c_white,3);
    draw_set_blend_mode_ext(bm_src_alpha, bm_one);
    draw_circle_color(h*surfsize/2, h*surfsize/2, h*surfsize*0.7, c_dkgray, c_black, 0);
    draw_set_blend_mode(bm_normal);
    surface_reset_target();
}
if (surface_exists(col1)==false) {
    col1 = surface_create(1, 1);
    surface_set_target(col1);
    draw_set_alpha(1);
    draw_point_color(0, 0, c_aqua);
    surface_reset_target();
}
if (surface_exists(col2)==false) {
    col2 = surface_create(1, 1);
    surface_set_target(col2);
    draw_set_alpha(1);
    draw_point_color(0, 0, c_black);
    surface_reset_target();
}
draw_set_alpha(1);
draw_set_color(c_black);
draw_rectangle(0, 0, view_wview[view_current], view_hview[view_current], 0);

if (os_get_config()!="OEM") {
    d3d_start();
    d3d_set_projection_euler(x,y,0.65*gridsize,direction,zdirection,0,0);
    d3d_draw_floor(0,0,-0.1,w*gridsize,h*gridsize,-0.1,-1,1,1);
    d3d_draw_floor(0,0,gridsize,w*gridsize,h*gridsize,gridsize,-1,1,1);
    draw_set_color(c_white);
    maze_draw_d3d(maze,0,0,0,w*gridsize,h*gridsize,gridsize,surface_get_texture(col2), surface_get_texture(col2), gridperc);
    
    d3d_set_hidden(false);
    d3d_transform_set_identity()
    //d3d_set_lighting(false)
    d3d_transform_add_rotation_x((0-zdirection)/2+25);
    d3d_transform_add_rotation_z(270+direction);
    
    var scale = 1/(power(2, gridsize*0.7));
    d3d_transform_add_scaling(scale, scale, scale);
    d3d_transform_add_translation(x+lengthdir_x(0.5*gridsize,direction), y+lengthdir_y(0.5*gridsize,direction), 0.25*gridsize);
    draw_surface(surf, 0-surface_get_width(surf)/2, 0-surface_get_height(surf)/2);
    draw_set_color(c_red);
    draw_circle(x/(w*gridsize)*(w*surfsize)-(w*surfsize)/2, y/(h*gridsize)*(h*surfsize)-(h*surfsize)/2, 0.1*surfsize, 0);
    xlist = ds_list_create();
    ylist = ds_list_create();
    with (obj_gameobject) {
        ds_list_add(other.xlist, x);
        ds_list_add(other.ylist, y);
    }
    draw_set_color(c_white);
    for (var i=0; i&lt;ds_list_size(xlist); i++) {
        draw_circle(ds_list_find_value(xlist, i)/(w*gridsize)*(w*surfsize)-(w*surfsize)/2, ds_list_find_value(ylist, i)/(h*gridsize)*(h*surfsize)-(h*surfsize)/2, 0.1*surfsize, 0);
    }
    ds_list_destroy(xlist);
    ds_list_destroy(ylist);
    
    //d3d_set_lighting(true)
    d3d_transform_set_identity();
    d3d_set_hidden(true);
} else {
    draw_surface(surf, 0, 0);
    draw_set_color(c_red);
    draw_circle(x/(w*gridsize)*(w*surfsize), y/(h*gridsize)*(h*surfsize), 0.1*surfsize, 0);
    draw_line(x/(w*gridsize)*(w*surfsize), y/(h*gridsize)*(h*surfsize), x/(w*gridsize)*(w*surfsize)+lengthdir_x(1/6*surfsize, direction), y/(h*gridsize)*(h*surfsize)+lengthdir_y(1/6*surfsize, direction));
    xlist = ds_list_create();
    ylist = ds_list_create();
    with (obj_gameobject) {
        ds_list_add(other.xlist, x);
        ds_list_add(other.ylist, y);
    }
    draw_set_color(c_white);
    for (var i=0; i&lt;ds_list_size(xlist); i++) {
        draw_circle(ds_list_find_value(xlist, i)/(w*gridsize)*(w*surfsize), ds_list_find_value(ylist, i)/(h*gridsize)*(h*surfsize), 0.1*surfsize, 0);
    }
    ds_list_destroy(xlist);
    ds_list_destroy(ylist);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="10" enumb="38">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>maze = create_maze(w, h);
surface_free(surf);
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
